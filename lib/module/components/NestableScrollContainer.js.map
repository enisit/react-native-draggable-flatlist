{"version":3,"names":["React","ScrollView","Animated","runOnJS","useAnimatedScrollHandler","NestableScrollContainerProvider","useSafeNestableScrollContainerContext","useStableCallback","AnimatedScrollView","createAnimatedComponent","isCloseToBottom","layoutMeasurement","contentOffset","contentSize","paddingToBottom","height","y","NestableScrollContainerInner","props","outerScrollOffset","containerSize","scrollViewSize","scrollableRef","outerScrollEnabled","handleEndReached","onEndReached","scrollHandler","onScroll","scrollProps","value","onLayout","event","nativeEvent","layout","onContentSizeChange","w","h","NestableScrollContainer","forwardRef","forwardedRef","undefined"],"sources":["NestableScrollContainer.tsx"],"sourcesContent":["import React from \"react\";\nimport {\n  LayoutChangeEvent,\n  NativeScrollEvent,\n  ScrollViewProps,\n} from \"react-native\";\nimport { ScrollView } from \"react-native-gesture-handler\";\nimport Animated, {\n  runOnJS,\n  useAnimatedScrollHandler,\n} from \"react-native-reanimated\";\nimport {\n  NestableScrollContainerProvider,\n  useSafeNestableScrollContainerContext,\n} from \"../context/nestableScrollContainerContext\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\n\nconst AnimatedScrollView = Animated.createAnimatedComponent(ScrollView);\nconst isCloseToBottom = ({\n  layoutMeasurement,\n  contentOffset,\n  contentSize,\n}: NativeScrollEvent) => {\n  const paddingToBottom = 20;\n  return (\n    layoutMeasurement.height + contentOffset.y >=\n    contentSize.height - paddingToBottom\n  );\n};\ntype NestableScrollContainerInnerProps = {\n  onEndReached?: () => void;\n} & ScrollViewProps;\nfunction NestableScrollContainerInner(\n  props: NestableScrollContainerInnerProps\n) {\n  const {\n    outerScrollOffset,\n    containerSize,\n    scrollViewSize,\n    scrollableRef,\n    outerScrollEnabled,\n  } = useSafeNestableScrollContainerContext();\n  const handleEndReached = useStableCallback(() => {\n    props.onEndReached?.();\n  });\n\n  const scrollHandler = useAnimatedScrollHandler({\n    onScroll: (scrollProps) => {\n      outerScrollOffset.value = scrollProps.contentOffset.y;\n      if (isCloseToBottom(scrollProps)) {\n        runOnJS(handleEndReached)();\n      }\n    },\n  });\n\n  const onLayout = useStableCallback((event: LayoutChangeEvent) => {\n    const {\n      nativeEvent: { layout },\n    } = event;\n    containerSize.value = layout.height;\n  });\n\n  const onContentSizeChange = useStableCallback((w: number, h: number) => {\n    scrollViewSize.value = h;\n    props.onContentSizeChange?.(w, h);\n  });\n\n  return (\n    <AnimatedScrollView\n      {...props}\n      onLayout={onLayout}\n      onContentSizeChange={onContentSizeChange}\n      scrollEnabled={outerScrollEnabled}\n      ref={scrollableRef}\n      scrollEventThrottle={1}\n      onScroll={scrollHandler}\n    />\n  );\n}\n\nexport const NestableScrollContainer = React.forwardRef(\n  (\n    props: NestableScrollContainerInnerProps,\n    forwardedRef?: React.ForwardedRef<ScrollView>\n  ) => {\n    return (\n      <NestableScrollContainerProvider\n        forwardedRef={\n          (forwardedRef as React.MutableRefObject<ScrollView>) || undefined\n        }\n      >\n        <NestableScrollContainerInner {...props} />\n      </NestableScrollContainerProvider>\n    );\n  }\n);\n"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAMA,SAASC,UAAT,QAA2B,8BAA3B;AACA,OAAOC,QAAP,IACEC,OADF,EAEEC,wBAFF,QAGO,yBAHP;AAIA,SACEC,+BADF,EAEEC,qCAFF,QAGO,2CAHP;AAIA,SAASC,iBAAT,QAAkC,4BAAlC;AAEA,MAAMC,kBAAkB,GAAGN,QAAQ,CAACO,uBAAT,CAAiCR,UAAjC,CAA3B;;AACA,MAAMS,eAAe,GAAG,QAIC;EAAA,IAJA;IACvBC,iBADuB;IAEvBC,aAFuB;IAGvBC;EAHuB,CAIA;EACvB,MAAMC,eAAe,GAAG,EAAxB;EACA,OACEH,iBAAiB,CAACI,MAAlB,GAA2BH,aAAa,CAACI,CAAzC,IACAH,WAAW,CAACE,MAAZ,GAAqBD,eAFvB;AAID,CAVD;;AAcA,SAASG,4BAAT,CACEC,KADF,EAEE;EACA,MAAM;IACJC,iBADI;IAEJC,aAFI;IAGJC,cAHI;IAIJC,aAJI;IAKJC;EALI,IAMFjB,qCAAqC,EANzC;EAOA,MAAMkB,gBAAgB,GAAGjB,iBAAiB,CAAC,MAAM;IAAA;;IAC/C,uBAAAW,KAAK,CAACO,YAAN,iFAAAP,KAAK;EACN,CAFyC,CAA1C;EAIA,MAAMQ,aAAa,GAAGtB,wBAAwB,CAAC;IAC7CuB,QAAQ,EAAGC,WAAD,IAAiB;MACzBT,iBAAiB,CAACU,KAAlB,GAA0BD,WAAW,CAAChB,aAAZ,CAA0BI,CAApD;;MACA,IAAIN,eAAe,CAACkB,WAAD,CAAnB,EAAkC;QAChCzB,OAAO,CAACqB,gBAAD,CAAP;MACD;IACF;EAN4C,CAAD,CAA9C;EASA,MAAMM,QAAQ,GAAGvB,iBAAiB,CAAEwB,KAAD,IAA8B;IAC/D,MAAM;MACJC,WAAW,EAAE;QAAEC;MAAF;IADT,IAEFF,KAFJ;IAGAX,aAAa,CAACS,KAAd,GAAsBI,MAAM,CAAClB,MAA7B;EACD,CALiC,CAAlC;EAOA,MAAMmB,mBAAmB,GAAG3B,iBAAiB,CAAC,CAAC4B,CAAD,EAAYC,CAAZ,KAA0B;IAAA;;IACtEf,cAAc,CAACQ,KAAf,GAAuBO,CAAvB;IACA,yBAAAlB,KAAK,CAACgB,mBAAN,qFAAAhB,KAAK,EAAuBiB,CAAvB,EAA0BC,CAA1B,CAAL;EACD,CAH4C,CAA7C;EAKA,oBACE,oBAAC,kBAAD,eACMlB,KADN;IAEE,QAAQ,EAAEY,QAFZ;IAGE,mBAAmB,EAAEI,mBAHvB;IAIE,aAAa,EAAEX,kBAJjB;IAKE,GAAG,EAAED,aALP;IAME,mBAAmB,EAAE,CANvB;IAOE,QAAQ,EAAEI;EAPZ,GADF;AAWD;;AAED,OAAO,MAAMW,uBAAuB,gBAAGrC,KAAK,CAACsC,UAAN,CACrC,CACEpB,KADF,EAEEqB,YAFF,KAGK;EACH,oBACE,oBAAC,+BAAD;IACE,YAAY,EACTA,YAAD,IAAwDC;EAF5D,gBAKE,oBAAC,4BAAD,EAAkCtB,KAAlC,CALF,CADF;AASD,CAdoC,CAAhC"}