{"version":3,"names":["AnimatedScrollView","Animated","createAnimatedComponent","ScrollView","isCloseToBottom","layoutMeasurement","contentOffset","contentSize","paddingToBottom","height","y","NestableScrollContainerInner","props","useSafeNestableScrollContainerContext","outerScrollOffset","containerSize","scrollViewSize","scrollableRef","outerScrollEnabled","handleEndReached","useStableCallback","onEndReached","scrollHandler","useAnimatedScrollHandler","onScroll","scrollProps","value","runOnJS","onLayout","event","layout","nativeEvent","onContentSizeChange","w","h","NestableScrollContainer","React","forwardRef","forwardedRef","undefined"],"sources":["NestableScrollContainer.tsx"],"sourcesContent":["import React from \"react\";\nimport {\n  LayoutChangeEvent,\n  NativeScrollEvent,\n  ScrollViewProps,\n} from \"react-native\";\nimport { ScrollView } from \"react-native-gesture-handler\";\nimport Animated, {\n  runOnJS,\n  useAnimatedScrollHandler,\n} from \"react-native-reanimated\";\nimport {\n  NestableScrollContainerProvider,\n  useSafeNestableScrollContainerContext,\n} from \"../context/nestableScrollContainerContext\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\n\nconst AnimatedScrollView = Animated.createAnimatedComponent(ScrollView);\nconst isCloseToBottom = ({\n  layoutMeasurement,\n  contentOffset,\n  contentSize,\n}: NativeScrollEvent) => {\n  const paddingToBottom = 20;\n  return (\n    layoutMeasurement.height + contentOffset.y >=\n    contentSize.height - paddingToBottom\n  );\n};\ntype NestableScrollContainerInnerProps = {\n  onEndReached?: () => void;\n} & ScrollViewProps;\nfunction NestableScrollContainerInner(\n  props: NestableScrollContainerInnerProps\n) {\n  const {\n    outerScrollOffset,\n    containerSize,\n    scrollViewSize,\n    scrollableRef,\n    outerScrollEnabled,\n  } = useSafeNestableScrollContainerContext();\n  const handleEndReached = useStableCallback(() => {\n    props.onEndReached?.();\n  });\n\n  const scrollHandler = useAnimatedScrollHandler({\n    onScroll: (scrollProps) => {\n      outerScrollOffset.value = scrollProps.contentOffset.y;\n      if (isCloseToBottom(scrollProps)) {\n        runOnJS(handleEndReached)();\n      }\n    },\n  });\n\n  const onLayout = useStableCallback((event: LayoutChangeEvent) => {\n    const {\n      nativeEvent: { layout },\n    } = event;\n    containerSize.value = layout.height;\n  });\n\n  const onContentSizeChange = useStableCallback((w: number, h: number) => {\n    scrollViewSize.value = h;\n    props.onContentSizeChange?.(w, h);\n  });\n\n  return (\n    <AnimatedScrollView\n      {...props}\n      onLayout={onLayout}\n      onContentSizeChange={onContentSizeChange}\n      scrollEnabled={outerScrollEnabled}\n      ref={scrollableRef}\n      scrollEventThrottle={1}\n      onScroll={scrollHandler}\n    />\n  );\n}\n\nexport const NestableScrollContainer = React.forwardRef(\n  (\n    props: NestableScrollContainerInnerProps,\n    forwardedRef?: React.ForwardedRef<ScrollView>\n  ) => {\n    return (\n      <NestableScrollContainerProvider\n        forwardedRef={\n          (forwardedRef as React.MutableRefObject<ScrollView>) || undefined\n        }\n      >\n        <NestableScrollContainerInner {...props} />\n      </NestableScrollContainerProvider>\n    );\n  }\n);\n"],"mappings":"mQAAA,oDAMA,uEACA,uFAIA,yFAIA,6D,ooCAEA,GAAMA,mBAAkB,CAAGC,8BAAA,CAASC,uBAAT,CAAiCC,qCAAjC,CAA3B,CACA,GAAMC,gBAAe,CAAG,QAAlBA,gBAAkB,MAIC,IAHvBC,kBAGuB,MAHvBA,iBAGuB,CAFvBC,aAEuB,MAFvBA,aAEuB,CADvBC,WACuB,MADvBA,WACuB,CACvB,GAAMC,gBAAe,CAAG,EAAxB,CACA,MACEH,kBAAiB,CAACI,MAAlB,CAA2BH,aAAa,CAACI,CAAzC,EACAH,WAAW,CAACE,MAAZ,CAAqBD,eAFvB,CAID,CAVD,CAcA,QAASG,6BAAT,CACEC,KADF,CAEE,2BAOI,GAAAC,qEAAA,GAPJ,CAEEC,iBAFF,uBAEEA,iBAFF,CAGEC,aAHF,uBAGEA,aAHF,CAIEC,cAJF,uBAIEA,cAJF,CAKEC,aALF,uBAKEA,aALF,CAMEC,kBANF,uBAMEA,kBANF,CAQA,GAAMC,iBAAgB,CAAG,GAAAC,oCAAA,EAAkB,UAAM,CAC/CR,KAAK,CAACS,YAAN,cAAAT,KAAK,CAACS,YAAN,GACD,CAFwB,CAAzB,CAIA,GAAMC,cAAa,CAAG,GAAAC,+CAAA,EAAyB,CAC7CC,QAAQ,+BAAGC,WAAH,CAAmB,CACzBX,iBAAiB,CAACY,KAAlB,CAA0BD,WAAW,CAACnB,aAAZ,CAA0BI,CAApD,CACA,GAAIN,eAAe,CAACqB,WAAD,CAAnB,CAAkC,CAChC,GAAAE,8BAAA,EAAQR,gBAAR,IACD,CACF,CALO,gCA7CVL,iBA6CU,iBA3CNV,eA2CM,SA1CRuB,8BA0CQ,kBA1CAR,gBA0CA,kaADqC,CAAzB,CAAtB,CASA,GAAMS,SAAQ,CAAG,GAAAR,oCAAA,EAAkB,SAACS,KAAD,CAA8B,IAE9CC,OAF8C,CAG3DD,KAH2D,CAE7DE,WAF6D,CAE9CD,MAF8C,CAI/Df,aAAa,CAACW,KAAd,CAAsBI,MAAM,CAACrB,MAA7B,CACD,CALgB,CAAjB,CAOA,GAAMuB,oBAAmB,CAAG,GAAAZ,oCAAA,EAAkB,SAACa,CAAD,CAAYC,CAAZ,CAA0B,CACtElB,cAAc,CAACU,KAAf,CAAuBQ,CAAvB,CACAtB,KAAK,CAACoB,mBAAN,cAAApB,KAAK,CAACoB,mBAAN,CAA4BC,CAA5B,CAA+BC,CAA/B,EACD,CAH2B,CAA5B,CAKA,MACE,8BAAC,kBAAD,0BACMtB,KADN,EAEE,QAAQ,CAAEgB,QAFZ,CAGE,mBAAmB,CAAEI,mBAHvB,CAIE,aAAa,CAAEd,kBAJjB,CAKE,GAAG,CAAED,aALP,CAME,mBAAmB,CAAE,CANvB,CAOE,QAAQ,CAAEK,aAPZ,6EADF,CAWD,CAEM,GAAMa,wBAAuB,CAAGC,cAAA,CAAMC,UAAN,CACrC,SACEzB,KADF,CAEE0B,YAFF,CAGK,CACH,MACE,8BAAC,+DAAD,EACE,YAAY,CACTA,YAAD,EAAwDC,SAF5D,6EAKE,6BAAC,4BAAD,0BAAkC3B,KAAlC,+EALF,CADF,CASD,CAdoC,CAAhC,C"}